# 2016年热门IOT通信标准前瞻之 《一》： wifi mesh

标签（空格分隔）： IOT通信标准

实际上，wifi mesh的技术并不是专门为IOT设计的。早在10年前，就已经有很多的探讨，甚至推出了802.11s标准，至于为什么没有得到普及，后面再说。
适用于IOT的wifi mesh，和802.11s标准有一些相通的地方，但是出发点还是不太一样的。802.11s里定义的wifi mesh有两个初衷一是为了均衡负荷，解决单一接入点负荷过大的问题，二是为了扩大wifi的覆盖面积。同时802.11s在基础网络的架构上着墨较多，而在IOT，尤其本文的重点会放在讨论智能家居的wifi mesh网络场景。

事实上，笔者目前还没有看到关于IOT的wifi mesh的标准，也许各家的还会不断的推出新的协议标准。就以ESP mesh为例，从它的文档里扒来一幅图：可以先一窥wifi mesh的网络拓扑：

![esp mesh 组网图][1]

##什么是Mesh组网？
> 无线Mesh网络（无线网状网络）也称为“多跳（multi-hop）”网络，它是一种与传统无线网络完全不同的新型无线网络技术。无线网状网是一种基于多跳路由、 对等网络技术的新型网络结构，具有移动宽带的特性，同时它本身可以动态地不断扩展，自组网、自管理，自动修复、自我平衡。相对于Wi-Fi，无线Mesh在组网方式、传输距离以及移动性上 都有很大的改进，特别是它具有兼容Wi-Fi的特性，因此无线Mesh网络会对Wi-Fi在增加传输距离和移动性，扩展Wi-Fi应用上提供很大帮助。

简单的说，就是通过增加接入点，以扩大无线网络的覆盖半径和负荷均衡，网络结构也由传统的星型变成网状；

##Wifi mesh会为用户做些什么？
如果在Wifi mesh基础上叠加适当的应用，从用户的角度看，画面还是相当美好的：

 - 启用配置极其方便，这是智能硬件最头疼的环节之一。购买了家庭智能硬件包括，但不局限于：智能温度计，智能空调，智能电灯，智能电饭煲，智能插座等等到手后，插上电，然后掏出手机启动APP，输入wifi密码，静静的等待配置就完成就好，无需关注是哪一部设备连接到了wifi上。 然后就是设置你所需要的应用了，比如温度计对空调的控制，插座的定时设置等等；
 - 自动组网。 这个动作用户是完全无需干预的，完成后，在手机上，会形成一幅拓扑图展现出来，用户可以清楚的知道哪些产品已经接入。ESP会组成树型结构。
 - 超长的覆盖半径（理论上可以达到半径500米，对于多数的壕宅也是够用了）。这是因为每一台设备都会化身为wifi接入点，因此，只要各台设备之间不超过100m，那么就不用担心设备接入不了网络；
 - 物物互通。这有点物联网该有的样子了，在即使没有网络的情况下，产品也可以相互通信。比如智能温度计发现温度过高，也可以通过内网通知智能空调开启；这样就摆脱了对云端的依赖，也减轻了家里路由的压力；与此同时，即使没有云端配合，手机APP也可以通过本地接入对所有的节点进行控制
 - 节省路由器。由于网络拓扑由星型变成树型结构，以及合理的路由分配，路由器会变得轻松很多（现在很多家庭的路由器实际上已经不堪重负）；
 
配置完成后，家庭里的组网如下：
![esp mesh组网图][2]

ps:理论上讲，wifi mesh只是网络层的软件升级，不需要硬件改造，因此大多数现有的设备都可以通过固件升级享受mesh网络带来的快捷。

##目前Wifi mesh的缺陷
当然了，和所有新出的技术一样，细思恐极，画面越美就意味着现实越骨感。以下这些问题一定会阻碍wifi mesh的普及：

- 功耗问题。这个是wifi一贯的问题，即使优化了，也依然老大难，不赘述。这里特意指出来，是因为这样一来，有可能会导致某些传感器设备由于功耗问题不能接入到mesh里的，直接导致它不能和整张mesh网络通信，这就失去了物物相连该有的；
- 让用户布点的问题会很多。事实上，wifi mesh在基础网架构败北的一个很重要的原因就在于网络实施的难度，甚至于需要考虑每一栋大楼和树冠的高度对于信号的影响，所以才退而求其次的在个别专用局域网才选择mesh。而这件事情对于普通消费来说就更加困难了。 尽管理论上讲，只要两点之间距离不太远以及阻挡不严重，都可以随意布置。但到了真实的部署环境里，隔壁开了微波炉都会影响你家的wifi信号，难道还需要为每个用户仔细的设计网络拓扑吗？
- 自组网协议的实现难度。做过基本的网络协议开发的人应该都能感觉到，wifi mesh的拓扑的动态维护，核心就在于管理好各个设备上的路由表。在这一点，路径发现非常像二层的STP，三层的RIP协议。而不知道这样的协议，对于物联网终端这种硬件资源非常有限，会不会捉襟见肘，尽管网络不会非常庞大。
- 对于用户，拓扑管理有很多难度。现在有很多的用户配个路由器，或者用smartconfig配置带wifi功能的智能硬件都费劲，别说让他们管理一张多台设备接入的网络了，万一其中有宕机的，如何协助他们快速排除问题，是一个极大的考验，要知道，如果每个用户都问你一遍，为什么空调和温度计不能联动，售后的成本是相当可怕的；其实 ， 作为zigbee，自组网方面尽管已经做了非常多得工作，但是仍然会被贴上难以安装的标签；
- 各厂家互通。目前wifi mesh还没有一个统一的方案，esp的方案里也还有很多需要完善的地方（甚至还没有推出RTOS版本的lib包）。这样就会导致一个很怪异的现象，就是买了某家的温度计，就必须要买它家的空调才能做联动（好像现状也是这样的，只能理解为出现同一平台前的过度时期吧）；


##Wifi mesh的未来
尽管讲了许多的缺陷，但我个人仍然是比较看好wifi mesh的未来。相比蓝牙和zigbee依托于中心网关才能接入IP网络的方案，wifi mesh有天然的基因优势。 而如果跳出智能家居的范畴，在诸如校园网或是楼宇部署方面，比起zigbee，各个集成商在部署方面的经验积累，wifi更是已经领先了十年了。

  [1]: http://static.zybuluo.com/xiaoleiSi/xjwjlpg3n6pp8fonu37xeniw/esp%20mesh%20%E7%BB%84%E7%BD%91.png
  [2]: http://static.zybuluo.com/xiaoleiSi/uo8u12rwxwu80ikn6r4usxwa/image_1aojbd7fq1t7ks2519bo23jg7gl.png